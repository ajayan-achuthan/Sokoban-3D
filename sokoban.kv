#:import utils kivy.utils
<ImageButton@ButtonBehavior+Image>
    allow_stretch: True
    keep_ratio:True
ScreenManager:
    MainScreen:
    NewGameScreen:
    LevelScreen:
    GameScreen:
      
<MainScreen>:
    canvas.before:
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'assets/images/new_game/main_bg.png'
    name: 'main'
    FloatLayout:
        size_hint: (1,1)
        pos_hint :{'y':0}
        Image:
            source: 'assets/images/new_game/main_undergrass_full.png'
            pos_hint: {'y': 0,'center_x':0.5}
            size_hint_x: 1
            allow_stretch: False
            keep_ratio: True
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y : 0.66
        BoxLayout:
            orientation: 'vertical'
            size_hint_y : 0.12
            Button:
                text: ''
                size_hint_x: 0.6
                pos_hint : {'center_x': .5, 'y': 0}
                background_normal: 'assets/images/new_game/main_start_btn.png'
                background_down: 'assets/images/new_game/main_start_btn.png'
                on_release: app.new_game(self)
        BoxLayout:
            size_hint_y : 0.039
        BoxLayout:
            orientation: 'horizontal'
            size_hint_y : 0.085
            size_hint_x: 0.6
            pos_hint: {'center_x':0.5}
            ImageButton:
                source : 'assets/images/new_game/main_settings_btn.png'
                size_hint_x: 0.8
                pos_hint : {'x': 0}
                on_release: app.settings(self)
            BoxLayout:
                size_hint_y : 0.6
            ImageButton:
                source : 'assets/images/new_game/main_exit_btn.png'
                size_hint_x: 0.8
                pos_hint : {'right': 1}
                on_release: app.exit(self)
        BoxLayout:
            size_hint_y : 0.096
    

<NewGameScreen>:
    name: 'new_game'
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#1a1a1a')
        Rectangle:
            pos: self.pos
            size: self.size
    FloatLayout:
        size_hint: (1,1)
        pos_hint :{'y':0}
        Image:
            source: 'assets/images/collections/collection_undergrass_full.png'
            pos_hint: {'y': 0,'center_x':0.5}
            size_hint_x: 1
            allow_stretch: False
            keep_ratio: True
    BoxLayout:
        orientation: 'vertical'
        pos_hint: {'center_x':0.5}
        BoxLayout:
            size_hint_y : 0.075
        Label:
            text: 'Collections'
            halign: 'left'
            valign: 'center'
            size_hint_y: 0.068
            size_hint_x: 0.8
            pos_hint: {'center_x':0.5}
        ScrollView:
            id: collection_scroll
            pos_hint: {'center_x':0.5,'top':1}
    	    size_hint_x: 0.8
            size_hint_y: 0.8
            BoxLayout:
                id: collection_grid
                orientation: 'vertical'
                size_hint_y : None
                height: self.minimum_height
                pos_hint: {'center_x':0.5,'top':1}
                spacing: 20
        BoxLayout:
            size_hint_y : 0.089


<LevelScreen>:
    name: 'levels'
    canvas.before:
        Color:
            rgba: utils.get_color_from_hex('#1a1a1a')
        Rectangle:
            pos: self.pos
            size: self.size
    BoxLayout:
        orientation: 'vertical'
        pos_hint: {'center_x':0.5}
        BoxLayout:
            size_hint_y : 0.075
        Label:
            canvas.before:
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: 'assets/images/levels/level_up.png'
            text: root.collection_name
            halign: 'left'
            valign: 'center'
            size_hint_y: 0.068
            size_hint_x: 0.8
            pos_hint: {'center_x':0.5}
        ScrollView:
            canvas.before:
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: 'assets/images/levels/level_down.png'
            id: level_scroll
            pos_hint: {'center_x':0.5,'top':1}
            size_hint_x: 0.8
            size_hint_y: 0.8
            GridLayout:
                id: level_grid
                cols: 4
                size_hint_y : None
                height: self.minimum_height
                pos_hint: {'center_x':0.5,'top':1}
                spacing: 20

<GameScreen>:
    name: 'game'
    canvas.before:
        Rectangle:
            pos: self.pos
            size: self.size
            source: 'assets/images/game/game_bg.png'
    BoxLayout:
        orientation: 'vertical'
        BoxLayout:
            size_hint_y: 0.05
        BoxLayout:
            canvas.before:
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: 'assets/images/game/game_top_bar.png'
            orientation: 'horizontal'
            size_hint_y: 0.1
            size_hint_x: 0.94
            pos_hint: {'center_x':0.5}
            BoxLayout:
                orientation: 'vertical'
                size_hint_x : 0.566
                Label:
                    text:'Level '+ root.level_name 
                    color : 0.435, 0.4, 0.361, 1
                    font_name : 'clearsans'
                    font_size: 50
                    markup: True
                    halign :'left'
                    valign : "middle"
                Label:
                    text:root.collection_name 
                    color : 0.435, 0.4, 0.361, 1
                    font_name : 'clearsans'
                    font_size: 18
                    markup: True
                    halign :'left'
                    valign : "middle"
            BoxLayout:
                orientation: 'vertical'
                size_hint_x : 0.217
                canvas.before:
                    Rectangle:
                        pos: self.pos
                        size: self.size
                        source: 'assets/images/game/game_moves.png'
                Label:
                    text:'MOVES' 
                    size_hint_y: 0.3
                    font_name : 'clearsans'
                    color : 0.98, 0.984, 0.98,1
                    font_size: 12
                    font_name : 'clearsans'
                Label:
                    id: moves_label
                    text:"{}".format(root.moves)
                    color : 0.98, 0.984, 0.98,1
                    font_size: 40
                    font_name : 'clearsans'
            BoxLayout:
                orientation: 'vertical'
                size_hint_x : 0.217
                canvas.before:
                    Rectangle:
                        pos: self.pos
                        size: self.size
                        source: 'assets/images/game/game_moves.png'
                Label:
                    text:'PUSHESS' 
                    size_hint_y: 0.3
                    font_name : 'clearsans'
                    color : 0.98, 0.984, 0.98,1
                    font_size: 12
                    font_name : 'clearsans'
                Label:
                    id: pushes_label
                    text:"{}".format(root.pushes)
                    color : 0.98, 0.984, 0.98,1
                    font_size: 40
                    font_name : 'clearsans'
        AnchorLayout:
            size_hint_y: 0.568
            size_hint_x: 0.94
            pos_hint: {'center_x':0.5}
            GridLayout:
                id: game_grid
                cols: 1
                spacing: 0
        BoxLayout:
            canvas.before:
                Rectangle:
                    pos: self.pos
                    size: self.size
                    source: 'assets/images/game/game_bottom_bar.png'
            orientation: 'horizontal'
            size_hint_y: 0.218
            size_hint_x: 0.94
            pos_hint: {'center_x':0.5}
            BoxLayout:
                orientation: 'vertical'
                size_hint_x:.17
                padding:[0,20]
                ImageButton:
                    source : 'assets/images/game/game_back_btn.png'
                    on_press:x: root.game.unmove()
                ImageButton:
                    source : 'assets/images/game/game_reset_btn.png'
                    on_press: root.game.reset()
                ImageButton:
                    source : 'assets/images/game/game_exit_btn.png'
                    on_press:app.back_to_show_levels()
            BoxLayout:
                size_hint_x:.278
            BoxLayout:
                size_hint_x:.552
                RelativeLayout:
                    ImageButton:
                        source : 'assets/images/game/game_up_btn.png'
                        pos_hint: {'center_x':0.5,'top':1}
                        size_hint_y:0.3
                        on_press: root.game.move(0,-1, True)
                    ImageButton:
                        source : 'assets/images/game/game_down_btn.png'
                        pos_hint: {'center_x':0.5,'y':0}
                        size_hint_y:0.3
                        on_press: root.game.move(0,1, True)
                    ImageButton:
                        source : 'assets/images/game/game_left_btn.png'
                        pos_hint: {'x':0,'center_y':0.5}
                        size_hint_x:0.3
                        on_press: root.game.move(-1,0, True)
                    ImageButton:
                        source : 'assets/images/game/game_right_btn.png'
                        pos_hint: {'right':1,'center_y':0.5}
                        size_hint_x:0.3
                        on_press: root.game.move(1,0, True)
        BoxLayout:
            size_hint_y: 0.064